---
title: "ggplot2 tutorial"
author: "Guillaume Lobet"
date: "5 Jun 2015"
output: pdf_document
---

# Introduction

## What is ggplot 

Used to produce statistical graphics, author = Hadley Wickham 
  "attempt to take the good things about base and lattice graphics and improve on them with a strong, underlying model "
  
ï¿¼based on The Grammar of Graphics by Leland Wilkinson, 2005

  "... describes the meaning of what we do when we construct statistical graphics ... More than a taxonomy ... Computational system based on the underlying mathematics of representing statistical functions of data."

- does not limit developer to a set of pre-specified graphics
- adds some concepts to grammar which allow it to work well with R

## ggplot components

- **data**: in ggplot2, data must be stored as an R data frame 
- **coordinate system**: describes 2-D space that data is projected onto 
- **geoms**: describe type of geometric objects that represent data
- **aesthetics**: describe visual characteristics that represent data
- **scales**: for each aesthetic, describe how visual characteristic is converted to display values
- **stats**: describe statistical transformations that typically summarize data
- **facets**: describe how data is split into subsets and displayed as multiple small graphs 


# Exercices

## Preparing the data

We will use a dataset of plant dry weight (root and leaf), with different treatment and genotypes.

```{r load_libraries, echo=FALSE}
library(ggplot2)

```

First we start by loading the dataset and looking at its structure.

```{r, echo=T}
rs <- read.csv("~/Desktop/dataset.csv")
str(rs)
```

We have three categorial variable: *genotype*, *treatment* and *floral*, one continous variable: *leaf_number* and two measurements: *root* and *leaf*. *floral* is still an *int* so we need to transform it to *factor*

```{r, echo=T}
rs$floral <- factor(rs$floral)
str(rs)
```

## Plotting the data


We first create the plot, by setting the data and the aestetic. 

```{r, echo=T}
myplot <- ggplot(data=rs, aes(x=root, y=leaf))
myplot
```

We need to add a *geom* to display the plot. Different *geom* can be used.

```{r, echo=T}

myplot + geom_point()
myplot + geom_line()
myplot + geom_step()

```


Combining the geoms is possible

```{r, echo=T}
myplot + geom_point() + geom_step()
```


We can also add a second dataset

```{r, echo=T}
rs1 <- rs[rs$treatment == "A",]
rs2 <- rs[rs$treatment == "B",]

myplot <- ggplot(data=rs1, aes(x=root, y=leaf)) + geom_point() 
myplot +  geom_line(data=rs2, aes(x=root, y=leaf, colour="red")) 

ggplot(data=rs, aes(root, leaf, pch=treatment)) + geom_point()

```


We can remove the chart junk
```{r, echo=T}

myplot + geom_point() + 
  theme_bw() # Remove the grey background

myplot + geom_point() + 
  theme_classic() # Remove the grey background

myplot + geom_point() + 
  theme_minimal() # Remove the grey background

```


Let's use the different categories we have in the dataset.

```{r, echo=T}

myplot <- ggplot(data=rs, aes(x=root, y=leaf, colour=genotype)) + theme_classic()

myplot + geom_point()

```

Continuous category

```{r, echo=T}

ggplot(data=rs, aes(x=root, y=leaf, colour=leaf_number)) +
  theme_classic() + 
  geom_point()

```

Two categories

```{r, echo=T}

ggplot(data=rs, aes(x=root, y=leaf, colour=genotype, pch=treatment)) + 
  theme_classic() + 
  geom_point()

```

Same but faceted

```{r, echo=T}

myplot <- ggplot(data=rs, aes(x=root, y=leaf, colour=genotype)) + theme_bw()  + geom_point()

myplot + facet_grid(genotype ~ treatment)
myplot + facet_grid(. ~ genotype)

myplot + facet_grid(treatment~genotype)

```


Let's add some stats here

```{r, echo=T}

myplot <- ggplot(data=rs, aes(x=leaf, y=root, colour=treatment)) + theme_classic()

myplot + geom_point() + geom_smooth(se = FALSE)

myplot + geom_point() +
  geom_smooth(se = TRUE)

myplot <- myplot + geom_point() +
  geom_smooth(se = TRUE, method="lm")

myplot + geom_point() +
  geom_smooth(se = T, method="lm")

```

Boxplot now

```{r, echo=T}

myplot <- ggplot(data=rs, aes(x=genotype, y=root, colour=treatment))
myplot + geom_boxplot()

```



Make it nicer

```{r, echo=T}

myplot <- ggplot(data=rs, aes(x=genotype, y=root, colour=genotype)) + theme_classic()

myplot + geom_boxplot(outlier.size=0) + geom_jitter()
```


Re-order the data

```{r, echo=T}

myplot <- ggplot(data=rs,  aes(x=reorder(genotype,root,FUN=mean), y=root, colour=genotype)) + 
  theme_classic()

myplot + geom_boxplot(outlier.size=0) + geom_jitter()

```


Modify the axes

```{r, echo=T}

myplot + geom_boxplot(outlier.size=0) + geom_jitter() + 
  ylab("Root dry weight [g]") +
  xlab("Genotype") +
  theme(text = element_text(size=20),
        axis.text.x = element_text(angle=45, vjust=.5)) 


```



